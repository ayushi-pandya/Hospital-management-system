{% extends 'Hospital/base.html' %}
{% load static %}
{% block title %}Medicine List{% endblock %}
{% block content %}
    <div class="container">
        <div class="card mb-4">
            <h6 class="card-header">Price</h6>
            <div class="list-group list-group-flush">
                <li class="list-group-item">
                    <input type="range" value="{{ minMaxPrice.charge__min }}" max="{{ minMaxPrice.charge__max }}"  min="{{ minMaxPrice.charge__min }}"  id="rangeInput"  oninput="maxPrice.value=this.value" />
                    <p>{{ minMaxPrice.charge__min }}-{{ minMaxPrice.charge__max }}</p>
                </li>
                <li class="list-group-item">
                    Max:<input type="number" value="{{ minMaxPrice.charge__min }}" max="{{ minMaxPrice.charge__max }}" min="{{ minMaxPrice.charge__min }}"  onkeyup="rangeInput.value=this.value"  id="maxPrice"  />
                    <button  class="btn btn-outline-primary btn-sm">Filter</button>
                </li>
            </div>
        </div>
        <form class="form-inline my-2 my-lg-0" method="post" role="search" action="{% url 'view-medicine' %}">
            {% csrf_token %}
            <input type="search" class="form-control" id="medicine_form" placeholder="search here.." name="search">
            <button class="btn btn-outline-primary my-2 my-sm-0" id="medicine_form" type="submit">Search</button>
            <p>Price</p>
            <input type="text" name="min_price" maxlength="4" size="3" >
            to <input type="text" name="max_price" maxlength="4" size="3">
            <input type="submit" value="Go">
        </form>
        <div>
             <div class="row my-4">
              <div class="col-sm">
              <table class="table">
              <tr>
                <th>id</th>
                <th>Name</th>
                <th>Charge</th>
                </tr>
                {% for m in all_data %}
                  <tr>
                    <td>{{ m.id }}</td>
                    <td>{{ m.medicine_name }}</td>
                    <td>{{ m.charge }}</td>
                    {% if user.role_id == 1 %}
                        <td> <a href="{% url 'update-medicine' m.id %}""><button type="button" class="btn btn-outline-secondary">Update</button></td>
                    {% endif %}
                  </tr>
                {% empty %}
                    {% for i in data %}
                       <tr>
                        <td>{{ i.id }}</td>
                        <td>{{ i.medicine_name }}</td>
                        <td>{{ i.charge }}</td>
                        {% if user.role_id == 1 %}
                            <td> <a href="{% url 'update-medicine' i.id %}""><button type="button" class="btn btn-outline-secondary">Update</button></td>
                        {% endif %}
                       </tr>
                    {% endfor %}
                {% endfor %}
              </table>
              </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
  <script>
    console.log('start')
    var availableTags = [ ];

    $.ajax({
        method:"GET",
        url:"{% url 'search-medicine' %}",
        success: function (response){
            console.log(response)
            startAutocomplete(response);
        }
    })
    function startAutocomplete(availableTags) {
        $("#medicine_form").autocomplete({
            source: availableTags
        });
    }
  </script>

  <script>
    $.("maxPrice").on('blur',function (){
        var _min=$(this).attr('min');
        var _max=$(this).attr('max');
        var _value=$(this).val();
        console.log(_value,_min,_max);
        if(_value < parseInt(_min) || _value > parseInt(_max)){
            alert('Values should be '+_min+'-'+_max);
            $(this).val(_min);
            $(this).focus();
            $("#rangeInput").val(_min);
            return false;
        }
    })
  </script>
{% endblock scripts %}